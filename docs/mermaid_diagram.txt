graph TD
      subgraph CLI
          A[main.py] -->|parse args| B[geometry/geom_io.py<br/>load_data/parse_geometry]
          A -->|commands| K[commands/context.py<br/>CommandContext]
      end

      subgraph Geometry
          B -->|builds| C[geometry/entities.py<br/>Mesh/Vertex/Edge/Facet]
          C -->|validates| E[exceptions.py<br/>InvalidEdgeIndexError]
      end

      subgraph Optimization
          C -->|passed to| D[runtime/minimizer.py<br/>Minimizer]
          D --> F[runtime/energy_manager.py]
          D --> G[runtime/constraint_manager.py]
          D --> H[runtime/steppers/conjugate_gradient.py]
      end

      subgraph Modules
          F -->|loads| I[modules/energy/*]
          G -->|loads| J[modules/constraints/*]
      end

      subgraph Runtime Utilities
          D --> L[runtime/topology.py<br/>safety checks]
          D --> M[runtime/refinement.py, vertex_average.py]
          K --> D
          H -->|updates vertices| C
      end

      %% styling
      classDef cli fill:#FDEDEC,stroke:#E74C3C,stroke-width:2px;
      classDef geom fill:#D6EAF8,stroke:#3498DB,stroke-width:2px;
      classDef opt fill:#FCF3CF,stroke:#F1C40F,stroke-width:2px;
      classDef mods fill:#E8F8F5,stroke:#1ABC9C,stroke-width:2px;

      class A,B,K cli;
      class C,E geom;
      class D,F,G,H,L,M opt;
      class I,J mods;
